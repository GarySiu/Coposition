<div id="friends">
  <% if current_user.pending_friends.present? %>
    You have sent <%= pluralize(current_user.pending_friends.count, 'friend request') %>.
  <% end %>

  <% friends.each do |friend| %>
    <div class="card row valign-wrapper">
      <div class="col s8 valign ">
      <a href="<%= user_friend_path(current_user.url_id, friend) %>">
        <h5><%= friends_name(friend) %></h5>
        <p>Friends since <%= humanize_date(current_user.approval_for(friend).approval_date) %></p>
      </a>
      </div>
      <div class="col s1 valign">
        <a class="waves-effect waves-light btn-flat modal-trigger" href="#perm<%=friend.id%>"><i class="material-icons">lock</i>Permissions</a>
        <div id="perm<%=friend.id%>" class="modal">
          <div class="modal-content">
            <h4 class="modal-content">Permissions Controls</h4>
            <ul class="permissions collection" data-friend=<%=friend.id%>>

              <% @devices.each do |device| %>
                <% permission =  device.permission_for(friend) %>
                <li class="collection-item row">
                  <div class='valign-wrapper col s8'> <%= device.name %></div>
                  <%= render partial: "users/permissions/controls", object: permission, as: 'permission' %>
                </li>
              <% end %>

            </ul>
          </div>
        </div>
      </div>
      <div class="col s3 valign">
        <%= button_to "Revoke Approval", reject_user_approval_path(current_user.url_id, current_user.approval_for(friend)), remote: true, class: "btn-flat", data: { confirm: "Are you sure? This user will no longer have access to any of your data." } %>
      </div>
    </div>
  <% end %>
</div>
