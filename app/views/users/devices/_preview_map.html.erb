<div id="map" class="square-map animated zoomIn hide"/>

<script>

navigator.geolocation.getCurrentPosition(showPosition, error);
function showPosition(position) {
  $('#add_button').removeClass("disabled");
  $('#add_button').prop('disabled', false);
  $('#map').removeClass("hide");
  COPO.maps.initMap();

  markerOptions = {
    icon: L.mapbox.marker.icon({ 'marker-symbol' : 'marker', 'marker-color' : '#ff6900' }),
    draggable: true
  }

  var marker = L.marker([position.coords.latitude, position.coords.longitude], markerOptions)
  var latlon = position.coords.longitude + "," + position.coords.latitude;
  $('#location').attr("value", latlon);
  marker.addTo(map);
  map.once('ready', function() {
    map.setView(marker.getLatLng(), 16)
  })

  marker.on('dragend', function(e) {
    var marker = e.target.getLatLng()
    var latlon = marker.lng + "," + marker.lat;
    $('#location').attr("value", latlon);
  })

}

function error(err){
  Materialize.toast('Could not get location', 3000)
}

</script>
