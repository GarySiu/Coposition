<div>
  <a id="<%= device.name %>" href="<%= user_device_path(current_user.url_id, device) %>">
    <h4><%= device.name %></h4>
    <%= devices_last_checkin(device) %>
    <%= devices_fog_status(device) %>
    <%= devices_delay_status(device)%>
  </a>

  <% if device.developers.exists? || device.permitted_users.exists? %>
      <a class="waves-effect waves-light btn modal-trigger" href="#modal<%=device.id%>"><i class="material-icons left">lock</i>Permissions</a>
      <div id="modal<%=device.id%>" class="modal">
        <ul class="permissions collection" data-device=<%=device.id%>>

          <% device.developers.each do |developer| %>
            <% @permission =  device.permissions.where(permissible: developer, permissible_type: 'Developer').first %>
            <li class="collection-item row" data-permission=<%=@permission.id%>>
              <%= permissible_title(developer) %>
              <%= render partial: "users/permissions/controls", object: @permission %>
            </li>
          <% end %>

          <% device.permitted_users.each do |friend| %>
            <% @permission =  device.permissions.where(permissible: friend, permissible_type: 'User').first %>
            <li class="collection-item row" data-permission=<%=@permission.id%>>
              <%= permissible_title(friend) %>
              <%= render partial: "users/permissions/controls", object: @permission %>
            </li>
          <% end %>

        </ul>
      </div>
  <% end %>
</div>
